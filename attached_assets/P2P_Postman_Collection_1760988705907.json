{
  "info": {
    "name": "P2P \u2013 API (Payments, Games, Leagues)",
    "_postman_id": "3b8f9e76-2e9f-4f3e-9b2a-1d1f1e7e9abc",
    "description": "Endpoints for OTP booking engine, payments, games, leagues, notifications.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/health",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "health"
          ]
        }
      }
    },
    {
      "name": "Venues - list",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{base_url}}/venues",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "venues"
          ]
        }
      }
    },
    {
      "name": "Slots - search (unbooked)",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{base_url}}/slots/search?venueId={{venue_id}}&sport={{sport}}&from={{from}}&to={{to}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "slots",
            "search"
          ],
          "query": [
            {
              "key": "venueId",
              "value": "{{venue_id}}"
            },
            {
              "key": "sport",
              "value": "{{sport}}"
            },
            {
              "key": "from",
              "value": "{{from}}"
            },
            {
              "key": "to",
              "value": "{{to}}"
            }
          ]
        }
      }
    },
    {
      "name": "Bookings - create (requires ID token)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"slotId\": \"{{slot_id}}\", \"amountPkr\": 2500}"
        },
        "url": {
          "raw": "{{base_url}}/bookings",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "bookings"
          ]
        }
      }
    },
    {
      "name": "Bookings - my bookings",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/bookings/me",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "bookings",
            "me"
          ]
        }
      }
    },
    {
      "name": "Payments \u2013 booking intent",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"bookingId\": \"{{booking_id}}\", \"amountPkr\": 2500, \"provider\": \"mock\"}"
        },
        "url": {
          "raw": "{{base_url}}/payments/intent",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "payments",
            "intent"
          ]
        }
      }
    },
    {
      "name": "Payments \u2013 webhook (mock)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const body = JSON.stringify({ paymentId: pm.collectionVariables.get('payment_id'), status: 'succeeded', providerRef: 'txn_123' });",
              "pm.variables.set('webhook_body', body);",
              "const secret = pm.environment.get('webhook_secret');",
              "function hmacSha256Hex(key, data){",
              "  const hmac = CryptoJS.HmacSHA256(data, key);",
              "  return hmac.toString(CryptoJS.enc.Hex);",
              "}",
              "pm.variables.set('webhook_sig', hmacSha256Hex(secret, body));"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-p2p-signature",
            "value": "{{webhook_sig}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{webhook_body}}"
        },
        "url": {
          "raw": "{{base_url}}/payments/webhook/mock",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "payments",
            "webhook",
            "mock"
          ]
        }
      }
    },
    {
      "name": "Games \u2013 create (host)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"fieldId\": \"{{field_id}}\", \"start\": \"{{iso_start}}\", \"end\": \"{{iso_end}}\", \"sport\": \"futsal\", \"minPlayers\": 8, \"maxPlayers\": 10, \"pricePkr\": 2500}"
        },
        "url": {
          "raw": "{{base_url}}/games",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "games"
          ]
        }
      }
    },
    {
      "name": "Games \u2013 search",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{base_url}}/games/search?sport={{sport}}",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "games",
            "search"
          ],
          "query": [
            {
              "key": "sport",
              "value": "{{sport}}"
            }
          ]
        }
      }
    },
    {
      "name": "GamePay \u2013 intent",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"provider\": \"mock\"}"
        },
        "url": {
          "raw": "{{base_url}}/game-pay/{{game_id}}/intent",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "game-pay",
            "{{game_id}}",
            "intent"
          ]
        }
      }
    },
    {
      "name": "GamePay \u2013 webhook success (mock)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const body = JSON.stringify({ gamePaymentId: pm.collectionVariables.get('game_payment_id'), status: 'succeeded', providerRef: 'txn_game_123' });",
              "pm.variables.set('game_webhook_body', body);",
              "const secret = pm.environment.get('webhook_secret');",
              "function hmacSha256Hex(key, data){",
              "  const hmac = CryptoJS.HmacSHA256(data, key);",
              "  return hmac.toString(CryptoJS.enc.Hex);",
              "}",
              "pm.variables.set('game_webhook_sig', hmacSha256Hex(secret, body));"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-p2p-signature",
            "value": "{{game_webhook_sig}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{{game_webhook_body}}"
        },
        "url": {
          "raw": "{{base_url}}/game-pay/webhook-game/mock",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "game-pay",
            "webhook-game",
            "mock"
          ]
        }
      }
    },
    {
      "name": "Users \u2013 save Expo push token",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"expoPushToken\": \"{{expo_push_token}}\"}"
        },
        "url": {
          "raw": "{{base_url}}/users/push-token",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "users",
            "push-token"
          ]
        }
      }
    },
    {
      "name": "Leagues \u2013 create season",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Spring 5v5\", \"sport\": \"futsal\", \"start\": \"{{iso_start}}\", \"end\": \"{{iso_end}}\"}"
        },
        "url": {
          "raw": "{{base_url}}/leagues/season",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "leagues",
            "season"
          ]
        }
      }
    },
    {
      "name": "Leagues \u2013 register team",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"name\": \"Team A\"}"
        },
        "url": {
          "raw": "{{base_url}}/leagues/season/{{season_id}}/team",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "leagues",
            "season",
            "{{season_id}}",
            "team"
          ]
        }
      }
    },
    {
      "name": "Leagues \u2013 generate fixtures",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/leagues/season/{{season_id}}/fixtures",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "leagues",
            "season",
            "{{season_id}}",
            "fixtures"
          ]
        }
      }
    },
    {
      "name": "Leagues \u2013 standings",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{id_token}}"
          }
        ],
        "url": {
          "raw": "{{base_url}}/leagues/season/{{season_id}}/standings",
          "host": [
            "{{base_url}}"
          ],
          "path": [
            "leagues",
            "season",
            "{{season_id}}",
            "standings"
          ]
        }
      }
    }
  ],
  "variable": [
    {
      "key": "payment_id",
      "value": ""
    },
    {
      "key": "game_payment_id",
      "value": ""
    }
  ]
}